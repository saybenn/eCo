{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/elijr/Desktop/CODING/Personal Projects/Portfolio/eco/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/elijr/Desktop/CODING/Personal Projects/Portfolio/eco/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/elijr/Desktop/CODING/Personal Projects/Portfolio/eco/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import axios from\"axios\";import{PayPalButton}from\"react-paypal-button-v2\";import{loadStripe}from\"@stripe/stripe-js\";import{Elements}from\"@stripe/react-stripe-js\";import CheckoutForm from\"../components/CheckoutForm\";import{Button,Form,Row,Col,ListGroup,Image,Card}from\"react-bootstrap\";import{Link,useNavigate,useParams}from\"react-router-dom\";import{useDispatch,useSelector}from\"react-redux\";import Container from\"../components/Container\";import Message from\"../components/Message\";import CheckoutSteps from\"../components/CheckoutSteps\";import{getOrder,payOrder}from\"../actions/orderActions\";import{logout}from\"../actions/userActions\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var stripePromise=loadStripe(\"pk_test_51KfRvoCiXm4UN3ie2rCe8bQxPrNDY3Fck0a33xKG8NlkqieYNBmUcd26Wu1DdKA9lrGZrDLBIPx7UhxBvVErUaEs00F5dPdgJD\");var PlaceOrderScreen=function PlaceOrderScreen(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),paymentMethod=_useState2[0],setPaymentMethod=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),clientSecret=_useState4[0],setClientSecret=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),sdkReady=_useState6[0],setSdkReady=_useState6[1];var _useParams=useParams(),id=_useParams.id;var dispatch=useDispatch();var navigate=useNavigate();var userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;var orderDetails=useSelector(function(state){return state.orderDetails;});var order=orderDetails.order,shippingAddress=orderDetails.shippingAddress,error=orderDetails.error;useEffect(function(){if(!userInfo){dispatch(logout());navigate(\"/login\");}dispatch(getOrder(id));function stripeHandler(){return _stripeHandler.apply(this,arguments);}function _stripeHandler(){_stripeHandler=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var name,email,_yield$axios$post,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:name=order.user.name;email=order.user.email;_context2.next=4;return axios.post(\"/create-payment-intent\",{id:id,name:name,email:email});case 4:_yield$axios$post=_context2.sent;data=_yield$axios$post.data;setClientSecret(data.clientSecret);case 7:case\"end\":return _context2.stop();}}},_callee2);}));return _stripeHandler.apply(this,arguments);}var addPayPalScript=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,clientId,script;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get(\"/api/config/paypal\");case 2:_yield$axios$get=_context.sent;clientId=_yield$axios$get.data;script=document.createElement(\"script\");script.type=\"text/javascript\";script.src=\"https://www.paypal.com/sdk/js?client-id=\".concat(clientId);script.async=true;script.onload=function(){setSdkReady(true);};document.body.appendChild(script);setSdkReady(true);case 11:case\"end\":return _context.stop();}}},_callee);}));return function addPayPalScript(){return _ref.apply(this,arguments);};}();if(paymentMethod===\"Stripe\"){console.log(paymentMethod);stripeHandler();}if(paymentMethod===\"PayPal\"){console.log(paymentMethod);addPayPalScript();}else{setSdkReady(true);}},[dispatch,id,userInfo,paymentMethod,sdkReady]);var appearance={theme:\"stripe\"};var options={clientSecret:clientSecret,appearance:appearance};var successPaymentHandler=function successPaymentHandler(){dispatch(payOrder(id,paymentMethod));};return/*#__PURE__*/_jsx(_Fragment,{children:order&&/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsx(CheckoutSteps,{step1:true,step2:true,step3:true,id:id}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Col,{md:8,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Order Items\"}),/*#__PURE__*/_jsx(Card,{className:\"p-3\",children:/*#__PURE__*/_jsx(ListGroup,{variant:\"flush\",children:order.orderItems.map(function(item){return/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{className:\"d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsx(Col,{md:2,children:/*#__PURE__*/_jsx(Image,{src:item.image,alt:item.name,fluid:true,rounded:true,sm:1})}),/*#__PURE__*/_jsx(Col,{md:2,children:/*#__PURE__*/_jsx(Link,{to:\"/product/\".concat(item.productId),children:item.name})}),/*#__PURE__*/_jsxs(Col,{md:2,children:[\"$\",item.price]}),/*#__PURE__*/_jsx(Col,{md:1,children:item.qty}),/*#__PURE__*/_jsx(Col,{className:\"d-flex justify-content-center\",md:2,children:item.totalPrice?\"$\".concat(item.totalPrice.toFixed(2)):\"$\".concat(item.price.toFixed(2))})]})},item._id);})})})]}),/*#__PURE__*/_jsxs(Col,{md:4,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Order Summary\"}),/*#__PURE__*/_jsx(Card,{className:\"p-3\",children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Items\"}),/*#__PURE__*/_jsxs(Col,{children:[\"$\",order.itemsPrice.toFixed(2)]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Shipping\"}),/*#__PURE__*/_jsxs(Col,{children:[\"$\",order.shippingPrice.toFixed(2)]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Tax\"}),/*#__PURE__*/_jsxs(Col,{children:[\"$\",order.taxPrice.toFixed(2)]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Total\"}),/*#__PURE__*/_jsxs(Col,{children:[\"$\",order.totalPrice.toFixed(2)]})]})})]})})]})]}),/*#__PURE__*/_jsxs(Row,{className:\"my-5\",children:[/*#__PURE__*/_jsxs(Col,{md:8,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Shipping Information\"}),/*#__PURE__*/_jsx(Card,{className:\"p-3\",children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Name:\"}),\" \",order.user.name]}),/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"email:\"}),\" \",order.user.email]}),/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Shipping Address:\"}),\" \".concat(order.shippingAddress.address,\", \").concat(order.shippingAddress.city,\" \").concat(order.shippingAddress.state,\" \").concat(order.shippingAddress.postalCode,\", \").concat(order.shippingAddress.country)]})]})})]}),/*#__PURE__*/_jsxs(Col,{md:4,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Payment Method\"}),/*#__PURE__*/_jsx(Card,{className:\"p-3\",children:!paymentMethod?/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsx(Form.Check,{type:\"radio\",label:\"Paypal\",id:\"PayPal\",name:\"paymentMethod\",value:\"PayPal\",onChange:function onChange(e){return setPaymentMethod(e.target.value);}}),/*#__PURE__*/_jsx(Form.Check,{type:\"radio\",label:\"Stripe/Credit Card\",id:\"Stripe\",name:\"paymentMethod\",value:\"Stripe\",onChange:function onChange(e){return setPaymentMethod(e.target.value);}}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"primary\",children:\"Continue\"})]}):paymentMethod===\"PayPal\"&&sdkReady?/*#__PURE__*/_jsx(PayPalButton,{amount:order.totalPrice,onSuccess:successPaymentHandler}):paymentMethod===\"Stripe\"&&clientSecret&&/*#__PURE__*/_jsx(Elements,{options:options,stripe:stripePromise,children:/*#__PURE__*/_jsx(CheckoutForm,{clientSecret:clientSecret,id:id})})})]})]})]})});};export default PlaceOrderScreen;","map":{"version":3,"sources":["C:/Users/elijr/Desktop/CODING/Personal Projects/Portfolio/eco/frontend/src/screens/OrderPayScreen.js"],"names":["React","useState","useEffect","axios","PayPalButton","loadStripe","Elements","CheckoutForm","Button","Form","Row","Col","ListGroup","Image","Card","Link","useNavigate","useParams","useDispatch","useSelector","Container","Message","CheckoutSteps","getOrder","payOrder","logout","stripePromise","PlaceOrderScreen","paymentMethod","setPaymentMethod","clientSecret","setClientSecret","sdkReady","setSdkReady","id","dispatch","navigate","userLogin","state","userInfo","orderDetails","order","shippingAddress","error","stripeHandler","name","user","email","post","data","addPayPalScript","get","clientId","script","document","createElement","type","src","async","onload","body","appendChild","console","log","appearance","theme","options","successPaymentHandler","orderItems","map","item","image","productId","price","qty","totalPrice","toFixed","_id","itemsPrice","shippingPrice","taxPrice","address","city","postalCode","country","e","target","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { PayPalButton } from \"react-paypal-button-v2\";\r\nimport { loadStripe } from \"@stripe/stripe-js\";\r\nimport { Elements } from \"@stripe/react-stripe-js\";\r\nimport CheckoutForm from \"../components/CheckoutForm\";\r\nimport {\r\n  Button,\r\n  Form,\r\n  Row,\r\n  Col,\r\n  ListGroup,\r\n  Image,\r\n  Card,\r\n} from \"react-bootstrap\";\r\nimport { Link, useNavigate, useParams } from \"react-router-dom\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport Container from \"../components/Container\";\r\nimport Message from \"../components/Message\";\r\nimport CheckoutSteps from \"../components/CheckoutSteps\";\r\nimport { getOrder, payOrder } from \"../actions/orderActions\";\r\nimport { logout } from \"../actions/userActions\";\r\n\r\nconst stripePromise = loadStripe(\r\n  \"pk_test_51KfRvoCiXm4UN3ie2rCe8bQxPrNDY3Fck0a33xKG8NlkqieYNBmUcd26Wu1DdKA9lrGZrDLBIPx7UhxBvVErUaEs00F5dPdgJD\"\r\n);\r\nconst PlaceOrderScreen = () => {\r\n  const [paymentMethod, setPaymentMethod] = useState(\"\");\r\n  const [clientSecret, setClientSecret] = useState(\"\");\r\n  const [sdkReady, setSdkReady] = useState(false);\r\n\r\n  const { id } = useParams();\r\n  const dispatch = useDispatch();\r\n  const navigate = useNavigate();\r\n\r\n  const userLogin = useSelector((state) => state.userLogin);\r\n  const { userInfo } = userLogin;\r\n\r\n  const orderDetails = useSelector((state) => state.orderDetails);\r\n  const { order, shippingAddress, error } = orderDetails;\r\n\r\n  useEffect(() => {\r\n    if (!userInfo) {\r\n      dispatch(logout());\r\n      navigate(\"/login\");\r\n    }\r\n    dispatch(getOrder(id));\r\n\r\n    async function stripeHandler() {\r\n      const name = order.user.name;\r\n      const email = order.user.email;\r\n      const { data } = await axios.post(\"/create-payment-intent\", {\r\n        id,\r\n        name,\r\n        email,\r\n      });\r\n      setClientSecret(data.clientSecret);\r\n    }\r\n\r\n    const addPayPalScript = async () => {\r\n      const { data: clientId } = await axios.get(\"/api/config/paypal\");\r\n      const script = document.createElement(\"script\");\r\n      script.type = \"text/javascript\";\r\n      script.src = `https://www.paypal.com/sdk/js?client-id=${clientId}`;\r\n      script.async = true;\r\n      script.onload = () => {\r\n        setSdkReady(true);\r\n      };\r\n      document.body.appendChild(script);\r\n      setSdkReady(true);\r\n    };\r\n    if (paymentMethod === \"Stripe\") {\r\n      console.log(paymentMethod);\r\n\r\n      stripeHandler();\r\n    }\r\n    if (paymentMethod === \"PayPal\") {\r\n      console.log(paymentMethod);\r\n      addPayPalScript();\r\n    } else {\r\n      setSdkReady(true);\r\n    }\r\n  }, [dispatch, id, userInfo, paymentMethod, sdkReady]);\r\n\r\n  const appearance = {\r\n    theme: \"stripe\",\r\n  };\r\n  const options = {\r\n    clientSecret,\r\n    appearance,\r\n  };\r\n\r\n  const successPaymentHandler = () => {\r\n    dispatch(payOrder(id, paymentMethod));\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {order && (\r\n        <Container>\r\n          <CheckoutSteps step1 step2 step3 id={id} />\r\n          <Row>\r\n            <Col md={8}>\r\n              <h2>Order Items</h2>\r\n              <Card className=\"p-3\">\r\n                <ListGroup variant=\"flush\">\r\n                  {order.orderItems.map((item) => (\r\n                    <ListGroup.Item key={item._id}>\r\n                      <Row className=\"d-flex justify-content-between align-items-center\">\r\n                        <Col md={2}>\r\n                          <Image\r\n                            src={item.image}\r\n                            alt={item.name}\r\n                            fluid\r\n                            rounded\r\n                            sm={1}\r\n                          />\r\n                        </Col>\r\n                        <Col md={2}>\r\n                          <Link to={`/product/${item.productId}`}>\r\n                            {item.name}\r\n                          </Link>\r\n                        </Col>\r\n                        <Col md={2}>${item.price}</Col>\r\n                        <Col md={1}>{item.qty}</Col>\r\n\r\n                        <Col className=\"d-flex justify-content-center\" md={2}>\r\n                          {item.totalPrice\r\n                            ? `$${item.totalPrice.toFixed(2)}`\r\n                            : `$${item.price.toFixed(2)}`}\r\n                        </Col>\r\n                      </Row>\r\n                    </ListGroup.Item>\r\n                  ))}\r\n                </ListGroup>\r\n              </Card>\r\n            </Col>\r\n            <Col md={4}>\r\n              <h2>Order Summary</h2>\r\n              <Card className=\"p-3\">\r\n                <ListGroup variant=\"flush\">\r\n                  <ListGroup.Item>\r\n                    <Row>\r\n                      <Col>Items</Col>\r\n                      <Col>${order.itemsPrice.toFixed(2)}</Col>\r\n                    </Row>\r\n                  </ListGroup.Item>\r\n                  <ListGroup.Item>\r\n                    <Row>\r\n                      <Col>Shipping</Col>\r\n                      <Col>${order.shippingPrice.toFixed(2)}</Col>\r\n                    </Row>\r\n                  </ListGroup.Item>\r\n                  <ListGroup.Item>\r\n                    <Row>\r\n                      <Col>Tax</Col>\r\n                      <Col>${order.taxPrice.toFixed(2)}</Col>\r\n                    </Row>\r\n                  </ListGroup.Item>\r\n                  <ListGroup.Item>\r\n                    <Row>\r\n                      <Col>Total</Col>\r\n                      <Col>${order.totalPrice.toFixed(2)}</Col>\r\n                    </Row>\r\n                  </ListGroup.Item>\r\n                </ListGroup>\r\n              </Card>\r\n            </Col>\r\n          </Row>\r\n          <Row className=\"my-5\">\r\n            <Col md={8}>\r\n              <h2>Shipping Information</h2>\r\n              <Card className=\"p-3\">\r\n                <ListGroup variant=\"flush\">\r\n                  <ListGroup.Item>\r\n                    <strong>Name:</strong> {order.user.name}\r\n                  </ListGroup.Item>\r\n                  <ListGroup.Item>\r\n                    <strong>email:</strong> {order.user.email}\r\n                  </ListGroup.Item>\r\n                  <ListGroup.Item>\r\n                    <strong>Shipping Address:</strong>\r\n                    {` ${order.shippingAddress.address}, ${order.shippingAddress.city} ${order.shippingAddress.state} ${order.shippingAddress.postalCode}, ${order.shippingAddress.country}`}\r\n                  </ListGroup.Item>\r\n                </ListGroup>\r\n              </Card>\r\n            </Col>\r\n            <Col md={4}>\r\n              <h2>Payment Method</h2>\r\n              <Card className=\"p-3\">\r\n                {!paymentMethod ? (\r\n                  <ListGroup variant=\"flush\">\r\n                    <Form.Check\r\n                      type=\"radio\"\r\n                      label=\"Paypal\"\r\n                      id=\"PayPal\"\r\n                      name=\"paymentMethod\"\r\n                      value=\"PayPal\"\r\n                      onChange={(e) => setPaymentMethod(e.target.value)}\r\n                    ></Form.Check>\r\n                    <Form.Check\r\n                      type=\"radio\"\r\n                      label=\"Stripe/Credit Card\"\r\n                      id=\"Stripe\"\r\n                      name=\"paymentMethod\"\r\n                      value=\"Stripe\"\r\n                      onChange={(e) => setPaymentMethod(e.target.value)}\r\n                    ></Form.Check>\r\n                    <Button type=\"submit\" variant=\"primary\">\r\n                      Continue\r\n                    </Button>\r\n                  </ListGroup>\r\n                ) : paymentMethod === \"PayPal\" && sdkReady ? (\r\n                  <PayPalButton\r\n                    amount={order.totalPrice}\r\n                    onSuccess={successPaymentHandler}\r\n                  />\r\n                ) : (\r\n                  paymentMethod === \"Stripe\" &&\r\n                  clientSecret && (\r\n                    <Elements options={options} stripe={stripePromise}>\r\n                      <CheckoutForm clientSecret={clientSecret} id={id} />\r\n                    </Elements>\r\n                  )\r\n                )}\r\n              </Card>\r\n            </Col>\r\n          </Row>\r\n        </Container>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default PlaceOrderScreen;\r\n"]},"metadata":{},"sourceType":"module"}