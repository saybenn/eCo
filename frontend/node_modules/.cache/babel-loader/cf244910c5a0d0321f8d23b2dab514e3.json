{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/elijr/Desktop/CODING/Personal Projects/Portfolio/eco/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/elijr/Desktop/CODING/Personal Projects/Portfolio/eco/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/elijr/Desktop/CODING/Personal Projects/Portfolio/eco/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import axios from\"axios\";import ReactQuill from\"react-quill\";import\"react-quill/dist/quill.snow.css\";import{useDispatch,useSelector}from\"react-redux\";import{Row,Col,Modal,Button,Form,Toast,Card}from\"react-bootstrap\";import Container from\"../components/Container\";import BlogScreenBlogPosts from\"../components/BlogScreenBlogPosts\";import FormContainer from\"../components/FormContainer\";import Loader from\"../components/Loader\";import Message from\"../components/Message\";import{listBlogs,createBlogPost}from\"../actions/blogActions\";import Tippy from\"@tippy.js/react\";import{requestAuthorship}from\"../actions/userActions\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var BlogScreen=function BlogScreen(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),convertedText=_useState2[0],setConvertedText=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),description=_useState4[0],setDescription=_useState4[1];var _useState5=useState(\"false\"),_useState6=_slicedToArray(_useState5,2),message=_useState6[0],setMessage=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),toastShow=_useState8[0],setToastShow=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),postShow=_useState10[0],setPostShow=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),postTitle=_useState12[0],setPostTitle=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),uploading=_useState14[0],setUploading=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),image=_useState16[0],setImage=_useState16[1];var handlePostClose=function handlePostClose(){return setPostShow(false);};var handlePostShow=function handlePostShow(){return setPostShow(true);};var userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;var userAuthor=useSelector(function(state){return state.userAuthor;});var authorSuccess=userAuthor.success;var blogList=useSelector(function(state){return state.blogList;});var loading=blogList.loading,error=blogList.error,blogs=blogList.blogs;var createBlog=useSelector(function(state){return state.createBlog;});var success=createBlog.success;var blogDeletePost=useSelector(function(state){return state.blogDeletePost;});var deleteSuccess=blogDeletePost.success;var blogLike=useSelector(function(state){return state.blogLike;});var likeSuccess=blogLike.success;var blogComment=useSelector(function(state){return state.blogComment;});var commentSuccess=blogComment.success;var dispatch=useDispatch();useEffect(function(){dispatch(listBlogs());if(authorSuccess){setMessage(\"Your request for the author role has been received.\");setTimeout(function(){setMessage(false);},5000);}},[dispatch,success,deleteSuccess,likeSuccess,authorSuccess,commentSuccess]);var submitHandler=function submitHandler(e){e.preventDefault();if(!userInfo.isAuthor){setToastShow(true);setMessage(\"Must be an author to make a post.\");setTimeout(function(){setMessage(false);},5000);}else{dispatch(createBlogPost(postTitle,convertedText,image,description));setConvertedText(\"\");setDescription(\"\");setPostTitle(\"\");}};var authorHandler=function authorHandler(){dispatch(requestAuthorship(userInfo._id));};var uploadFileHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var file,formData,config,_yield$axios$post,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:file=e.target.files[0];formData=new FormData();formData.append(\"image\",file);setUploading(true);_context.prev=4;config={headers:{\"Content-Type\":\"multipart/form-data\"}};_context.next=8;return axios.post(\"/api/upload\",formData,config);case 8:_yield$axios$post=_context.sent;data=_yield$axios$post.data;setImage(data);setUploading(false);_context.next=18;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](4);console.error(_context.t0);setUploading(false);case 18:case\"end\":return _context.stop();}}},_callee,null,[[4,14]]);}));return function uploadFileHandler(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsxs(Row,{className:\"d-flex justify-content-between\",children:[/*#__PURE__*/_jsxs(Col,{md:9,className:\"d-flex align-items-end\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Community Writing Blog\"}),\" \",authorSuccess&&/*#__PURE__*/_jsx(Message,{variant:\"info\",children:message})]}),/*#__PURE__*/_jsxs(Col,{md:3,className:\"d-flex justify-content-end align-items-end\",children:[userInfo&&userInfo.isAuthor&&/*#__PURE__*/_jsxs(Button,{variant:\"\",onClick:handlePostShow,children:[\"Create a Post \",/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-4x fa-edit\"})]}),!userInfo.isAuthor&&!userInfo.authorRequest&&/*#__PURE__*/_jsxs(Button,{variant:\"\",onClick:authorHandler,children:[\"Request Author Role \",/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-4x fa-edit\"}),/*#__PURE__*/_jsx(Tippy,{content:\"The Author role allows users to contribute their own blog post to the community. Requests must be approved by an Administrator.\",placement:\"top\",arrow:false,delay:300,children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-info-circle mx-1\"})})]})]})]}),/*#__PURE__*/_jsx(\"hr\",{style:{color:\"black\",backgroundColor:\"black\",height:5}}),/*#__PURE__*/_jsxs(Modal,{dialogClassName:\"w-50\",show:postShow,onHide:handlePostClose,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Create A Post\"})}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsx(FormContainer,{children:/*#__PURE__*/_jsxs(Form,{onSubmit:submitHandler,children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Post Title\"}),/*#__PURE__*/_jsx(Form.Group,{controlId:\"title\",children:/*#__PURE__*/_jsx(Form.Control,{value:postTitle,onChange:function onChange(e){return setPostTitle(e.target.value);}})}),/*#__PURE__*/_jsx(Form.Label,{children:\"Post Description\"}),/*#__PURE__*/_jsx(Form.Group,{controlId:\"description\",children:/*#__PURE__*/_jsx(Form.Control,{value:description,onChange:function onChange(e){return setDescription(e.target.value);},placeholder:\"What's this blog post about?\"})}),/*#__PURE__*/_jsx(Form.Label,{children:\"Post Body\"}),/*#__PURE__*/_jsx(Form.Group,{controlId:\"body\",children:/*#__PURE__*/_jsx(ReactQuill,{className:\"mb-2 p-1\",theme:\"snow\",value:convertedText,onChange:setConvertedText})}),/*#__PURE__*/_jsxs(Form.Group,{controlId:\"image\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Image\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",value:image,placeholder:\"Enter image url\",onChange:function onChange(e){return setImage(e.target.value);}}),/*#__PURE__*/_jsx(Form.Control,{id:\"image-file\",label:\"Choose File\",type:\"file\",onChange:uploadFileHandler}),uploading&&/*#__PURE__*/_jsx(Loader,{})]}),/*#__PURE__*/_jsx(Button,{className:\"my-3\",variant:\"outline-dark\",type:\"submit\",onClick:handlePostClose,children:\"Submit Blog Post\"})]})})})]}),loading&&/*#__PURE__*/_jsx(Loader,{}),error&&/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:error}),/*#__PURE__*/_jsx(Toast,{onClose:function onClose(){return setToastShow(false);},show:toastShow,delay:5000,autohide:true,children:/*#__PURE__*/_jsx(Toast.Header,{children:message})}),\" \",blogs&&blogs.length>0?/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(Row,{className:\"mb-3\",children:blogs.sort(function(a,b){return Date.parse(b.createdAt)-Date.parse(a.createdAt);}).map(function(blog){return/*#__PURE__*/_jsx(Col,{sm:12,md:6,lg:4,xl:4,children:/*#__PURE__*/_jsx(BlogScreenBlogPosts,{blog:blog})},blog._id);})})}):/*#__PURE__*/_jsx(Message,{variant:\"info\",children:\"No Blog Posts. Be the first to contribute to our community!\"})]})});};export default BlogScreen;","map":{"version":3,"sources":["C:/Users/elijr/Desktop/CODING/Personal Projects/Portfolio/eco/frontend/src/screens/BlogScreen.js"],"names":["React","useState","useEffect","axios","ReactQuill","useDispatch","useSelector","Row","Col","Modal","Button","Form","Toast","Card","Container","BlogScreenBlogPosts","FormContainer","Loader","Message","listBlogs","createBlogPost","Tippy","requestAuthorship","BlogScreen","convertedText","setConvertedText","description","setDescription","message","setMessage","toastShow","setToastShow","postShow","setPostShow","postTitle","setPostTitle","uploading","setUploading","image","setImage","handlePostClose","handlePostShow","userLogin","state","userInfo","userAuthor","authorSuccess","success","blogList","loading","error","blogs","createBlog","blogDeletePost","deleteSuccess","blogLike","likeSuccess","blogComment","commentSuccess","dispatch","setTimeout","submitHandler","e","preventDefault","isAuthor","authorHandler","_id","uploadFileHandler","file","target","files","formData","FormData","append","config","headers","post","data","console","authorRequest","color","backgroundColor","height","value","length","sort","a","b","Date","parse","createdAt","map","blog"],"mappings":"ojBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,UAAP,KAAuB,aAAvB,CACA,MAAO,iCAAP,CACA,OAASC,WAAT,CAAsBC,WAAtB,KAAyC,aAAzC,CACA,OAASC,GAAT,CAAcC,GAAd,CAAmBC,KAAnB,CAA0BC,MAA1B,CAAkCC,IAAlC,CAAwCC,KAAxC,CAA+CC,IAA/C,KAA2D,iBAA3D,CACA,MAAOC,CAAAA,SAAP,KAAsB,yBAAtB,CACA,MAAOC,CAAAA,mBAAP,KAAgC,mCAAhC,CACA,MAAOC,CAAAA,aAAP,KAA0B,6BAA1B,CACA,MAAOC,CAAAA,MAAP,KAAmB,sBAAnB,CACA,MAAOC,CAAAA,OAAP,KAAoB,uBAApB,CACA,OAASC,SAAT,CAAoBC,cAApB,KAA0C,wBAA1C,CACA,MAAOC,CAAAA,KAAP,KAAkB,iBAAlB,CACA,OAASC,iBAAT,KAAkC,wBAAlC,C,6IAEA,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,CACvB,cAA0CtB,QAAQ,CAAC,EAAD,CAAlD,wCAAOuB,aAAP,eAAsBC,gBAAtB,eACA,eAAsCxB,QAAQ,CAAC,EAAD,CAA9C,yCAAOyB,WAAP,eAAoBC,cAApB,eACA,eAA8B1B,QAAQ,CAAC,OAAD,CAAtC,yCAAO2B,OAAP,eAAgBC,UAAhB,eACA,eAAkC5B,QAAQ,CAAC,KAAD,CAA1C,yCAAO6B,SAAP,eAAkBC,YAAlB,eACA,eAAgC9B,QAAQ,CAAC,KAAD,CAAxC,0CAAO+B,QAAP,gBAAiBC,WAAjB,gBACA,gBAAkChC,QAAQ,CAAC,EAAD,CAA1C,2CAAOiC,SAAP,gBAAkBC,YAAlB,gBACA,gBAAkClC,QAAQ,CAAC,KAAD,CAA1C,2CAAOmC,SAAP,gBAAkBC,YAAlB,gBACA,gBAA0BpC,QAAQ,CAAC,EAAD,CAAlC,2CAAOqC,KAAP,gBAAcC,QAAd,gBAEA,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,SAAMP,CAAAA,WAAW,CAAC,KAAD,CAAjB,EAAxB,CACA,GAAMQ,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,SAAMR,CAAAA,WAAW,CAAC,IAAD,CAAjB,EAAvB,CAEA,GAAMS,CAAAA,SAAS,CAAGpC,WAAW,CAAC,SAACqC,KAAD,QAAWA,CAAAA,KAAK,CAACD,SAAjB,EAAD,CAA7B,CACA,GAAQE,CAAAA,QAAR,CAAqBF,SAArB,CAAQE,QAAR,CAEA,GAAMC,CAAAA,UAAU,CAAGvC,WAAW,CAAC,SAACqC,KAAD,QAAWA,CAAAA,KAAK,CAACE,UAAjB,EAAD,CAA9B,CACA,GAAiBC,CAAAA,aAAjB,CAAmCD,UAAnC,CAAQE,OAAR,CAEA,GAAMC,CAAAA,QAAQ,CAAG1C,WAAW,CAAC,SAACqC,KAAD,QAAWA,CAAAA,KAAK,CAACK,QAAjB,EAAD,CAA5B,CACA,GAAQC,CAAAA,OAAR,CAAkCD,QAAlC,CAAQC,OAAR,CAAiBC,KAAjB,CAAkCF,QAAlC,CAAiBE,KAAjB,CAAwBC,KAAxB,CAAkCH,QAAlC,CAAwBG,KAAxB,CAEA,GAAMC,CAAAA,UAAU,CAAG9C,WAAW,CAAC,SAACqC,KAAD,QAAWA,CAAAA,KAAK,CAACS,UAAjB,EAAD,CAA9B,CACA,GAAQL,CAAAA,OAAR,CAAoBK,UAApB,CAAQL,OAAR,CAEA,GAAMM,CAAAA,cAAc,CAAG/C,WAAW,CAAC,SAACqC,KAAD,QAAWA,CAAAA,KAAK,CAACU,cAAjB,EAAD,CAAlC,CACA,GAAiBC,CAAAA,aAAjB,CAAmCD,cAAnC,CAAQN,OAAR,CAEA,GAAMQ,CAAAA,QAAQ,CAAGjD,WAAW,CAAC,SAACqC,KAAD,QAAWA,CAAAA,KAAK,CAACY,QAAjB,EAAD,CAA5B,CACA,GAAiBC,CAAAA,WAAjB,CAAiCD,QAAjC,CAAQR,OAAR,CACA,GAAMU,CAAAA,WAAW,CAAGnD,WAAW,CAAC,SAACqC,KAAD,QAAWA,CAAAA,KAAK,CAACc,WAAjB,EAAD,CAA/B,CACA,GAAiBC,CAAAA,cAAjB,CAAoCD,WAApC,CAAQV,OAAR,CAEA,GAAMY,CAAAA,QAAQ,CAAGtD,WAAW,EAA5B,CAEAH,SAAS,CAAC,UAAM,CACdyD,QAAQ,CAACxC,SAAS,EAAV,CAAR,CAEA,GAAI2B,aAAJ,CAAmB,CACjBjB,UAAU,uDAAV,CACA+B,UAAU,CAAC,UAAM,CACf/B,UAAU,CAAC,KAAD,CAAV,CACD,CAFS,CAEP,IAFO,CAAV,CAGD,CACF,CATQ,CASN,CACD8B,QADC,CAEDZ,OAFC,CAGDO,aAHC,CAIDE,WAJC,CAKDV,aALC,CAMDY,cANC,CATM,CAAT,CAkBA,GAAMG,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACC,CAAD,CAAO,CAC3BA,CAAC,CAACC,cAAF,GACA,GAAI,CAACnB,QAAQ,CAACoB,QAAd,CAAwB,CACtBjC,YAAY,CAAC,IAAD,CAAZ,CACAF,UAAU,qCAAV,CACA+B,UAAU,CAAC,UAAM,CACf/B,UAAU,CAAC,KAAD,CAAV,CACD,CAFS,CAEP,IAFO,CAAV,CAGD,CAND,IAMO,CACL8B,QAAQ,CAACvC,cAAc,CAACc,SAAD,CAAYV,aAAZ,CAA2Bc,KAA3B,CAAkCZ,WAAlC,CAAf,CAAR,CACAD,gBAAgB,CAAC,EAAD,CAAhB,CACAE,cAAc,CAAC,EAAD,CAAd,CACAQ,YAAY,CAAC,EAAD,CAAZ,CACD,CACF,CAdD,CAgBA,GAAM8B,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,EAAM,CAC1BN,QAAQ,CAACrC,iBAAiB,CAACsB,QAAQ,CAACsB,GAAV,CAAlB,CAAR,CACD,CAFD,CAIA,GAAMC,CAAAA,iBAAiB,0FAAG,iBAAOL,CAAP,kKAClBM,IADkB,CACXN,CAAC,CAACO,MAAF,CAASC,KAAT,CAAe,CAAf,CADW,CAElBC,QAFkB,CAEP,GAAIC,CAAAA,QAAJ,EAFO,CAGxBD,QAAQ,CAACE,MAAT,CAAgB,OAAhB,CAAyBL,IAAzB,EACA/B,YAAY,CAAC,IAAD,CAAZ,CAJwB,gBAOhBqC,MAPgB,CAOP,CACbC,OAAO,CAAE,CACP,eAAgB,qBADT,CADI,CAPO,uBAYCxE,CAAAA,KAAK,CAACyE,IAAN,CAAW,aAAX,CAA0BL,QAA1B,CAAoCG,MAApC,CAZD,wCAYdG,IAZc,mBAYdA,IAZc,CActBtC,QAAQ,CAACsC,IAAD,CAAR,CACAxC,YAAY,CAAC,KAAD,CAAZ,CAfsB,iFAiBtByC,OAAO,CAAC5B,KAAR,cACAb,YAAY,CAAC,KAAD,CAAZ,CAlBsB,qEAAH,kBAAjB8B,CAAAA,iBAAiB,4CAAvB,CAqBA,mBACE,sCACE,MAAC,SAAD,yBACE,MAAC,GAAD,EAAK,SAAS,CAAC,gCAAf,wBACE,MAAC,GAAD,EAAK,EAAE,CAAE,CAAT,CAAY,SAAS,CAAC,wBAAtB,wBACE,8CADF,CACkC,GADlC,CAEGrB,aAAa,eAAI,KAAC,OAAD,EAAS,OAAO,CAAC,MAAjB,UAAyBlB,OAAzB,EAFpB,GADF,cAKE,MAAC,GAAD,EAAK,EAAE,CAAE,CAAT,CAAY,SAAS,CAAC,4CAAtB,WACGgB,QAAQ,EAAIA,QAAQ,CAACoB,QAArB,eACC,MAAC,MAAD,EAAQ,OAAO,CAAC,EAAhB,CAAmB,OAAO,CAAEvB,cAA5B,yCACgB,UAAG,SAAS,CAAC,mBAAb,EADhB,GAFJ,CAMG,CAACG,QAAQ,CAACoB,QAAV,EAAsB,CAACpB,QAAQ,CAACmC,aAAhC,eACC,MAAC,MAAD,EAAQ,OAAO,CAAC,EAAhB,CAAmB,OAAO,CAAEd,aAA5B,+CACsB,UAAG,SAAS,CAAC,mBAAb,EADtB,cAEE,KAAC,KAAD,EACE,OAAO,CAAC,iIADV,CAEE,SAAS,CAAC,KAFZ,CAGE,KAAK,CAAE,KAHT,CAIE,KAAK,CAAE,GAJT,uBAME,UAAG,SAAS,CAAC,yBAAb,EANF,EAFF,GAPJ,GALF,GADF,cA2BE,WACE,KAAK,CAAE,CACLe,KAAK,CAAE,OADF,CAELC,eAAe,CAAE,OAFZ,CAGLC,MAAM,CAAE,CAHH,CADT,EA3BF,cAkCE,MAAC,KAAD,EAAO,eAAe,CAAC,MAAvB,CAA8B,IAAI,CAAElD,QAApC,CAA8C,MAAM,CAAEQ,eAAtD,wBACE,KAAC,KAAD,CAAO,MAAP,EAAc,WAAW,KAAzB,uBACE,KAAC,KAAD,CAAO,KAAP,4BADF,EADF,cAIE,KAAC,KAAD,CAAO,IAAP,wBACE,KAAC,aAAD,wBACE,MAAC,IAAD,EAAM,QAAQ,CAAEqB,aAAhB,wBACE,KAAC,IAAD,CAAM,KAAN,yBADF,cAEE,KAAC,IAAD,CAAM,KAAN,EAAY,SAAS,CAAC,OAAtB,uBACE,KAAC,IAAD,CAAM,OAAN,EACE,KAAK,CAAE3B,SADT,CAEE,QAAQ,CAAE,kBAAC4B,CAAD,QAAO3B,CAAAA,YAAY,CAAC2B,CAAC,CAACO,MAAF,CAASc,KAAV,CAAnB,EAFZ,EADF,EAFF,cAQE,KAAC,IAAD,CAAM,KAAN,+BARF,cASE,KAAC,IAAD,CAAM,KAAN,EAAY,SAAS,CAAC,aAAtB,uBACE,KAAC,IAAD,CAAM,OAAN,EACE,KAAK,CAAEzD,WADT,CAEE,QAAQ,CAAE,kBAACoC,CAAD,QAAOnC,CAAAA,cAAc,CAACmC,CAAC,CAACO,MAAF,CAASc,KAAV,CAArB,EAFZ,CAGE,WAAW,CAAC,8BAHd,EADF,EATF,cAgBE,KAAC,IAAD,CAAM,KAAN,wBAhBF,cAiBE,KAAC,IAAD,CAAM,KAAN,EAAY,SAAS,CAAC,MAAtB,uBACE,KAAC,UAAD,EACE,SAAS,CAAC,UADZ,CAEE,KAAK,CAAC,MAFR,CAGE,KAAK,CAAE3D,aAHT,CAIE,QAAQ,CAAEC,gBAJZ,EADF,EAjBF,cAyBE,MAAC,IAAD,CAAM,KAAN,EAAY,SAAS,CAAC,OAAtB,wBACE,KAAC,IAAD,CAAM,KAAN,oBADF,cAEE,KAAC,IAAD,CAAM,OAAN,EACE,IAAI,CAAC,MADP,CAEE,KAAK,CAAEa,KAFT,CAGE,WAAW,CAAC,iBAHd,CAIE,QAAQ,CAAE,kBAACwB,CAAD,QAAOvB,CAAAA,QAAQ,CAACuB,CAAC,CAACO,MAAF,CAASc,KAAV,CAAf,EAJZ,EAFF,cAQE,KAAC,IAAD,CAAM,OAAN,EACE,EAAE,CAAC,YADL,CAEE,KAAK,CAAC,aAFR,CAGE,IAAI,CAAC,MAHP,CAIE,QAAQ,CAAEhB,iBAJZ,EARF,CAcG/B,SAAS,eAAI,KAAC,MAAD,IAdhB,GAzBF,cAyCE,KAAC,MAAD,EACE,SAAS,CAAC,MADZ,CAEE,OAAO,CAAC,cAFV,CAGE,IAAI,CAAC,QAHP,CAIE,OAAO,CAAEI,eAJX,8BAzCF,GADF,EADF,EAJF,GAlCF,CA6FGS,OAAO,eAAI,KAAC,MAAD,IA7Fd,CA8FGC,KAAK,eAAI,KAAC,OAAD,EAAS,OAAO,CAAC,QAAjB,UAA2BA,KAA3B,EA9FZ,cA+FE,KAAC,KAAD,EACE,OAAO,CAAE,yBAAMnB,CAAAA,YAAY,CAAC,KAAD,CAAlB,EADX,CAEE,IAAI,CAAED,SAFR,CAGE,KAAK,CAAE,IAHT,CAIE,QAAQ,KAJV,uBAME,KAAC,KAAD,CAAO,MAAP,WAAeF,OAAf,EANF,EA/FF,CAsGW,GAtGX,CAuGGuB,KAAK,EAAIA,KAAK,CAACiC,MAAN,CAAe,CAAxB,cACC,KAAC,IAAD,wBACE,KAAC,GAAD,EAAK,SAAS,CAAC,MAAf,UACGjC,KAAK,CACHkC,IADF,CAEG,SAACC,CAAD,CAAIC,CAAJ,QAAUC,CAAAA,IAAI,CAACC,KAAL,CAAWF,CAAC,CAACG,SAAb,EAA0BF,IAAI,CAACC,KAAL,CAAWH,CAAC,CAACI,SAAb,CAApC,EAFH,EAIEC,GAJF,CAIM,SAACC,IAAD,CAAU,CACb,mBACE,KAAC,GAAD,EAAoB,EAAE,CAAE,EAAxB,CAA4B,EAAE,CAAE,CAAhC,CAAmC,EAAE,CAAE,CAAvC,CAA0C,EAAE,CAAE,CAA9C,uBACE,KAAC,mBAAD,EAAqB,IAAI,CAAEA,IAA3B,EADF,EAAUA,IAAI,CAAC1B,GAAf,CADF,CAKD,CAVF,CADH,EADF,EADD,cAiBC,KAAC,OAAD,EAAS,OAAO,CAAC,MAAjB,yEAxHJ,GADF,EADF,CAiID,CA/ND,CAiOA,cAAe3C,CAAAA,UAAf","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport ReactQuill from \"react-quill\";\r\nimport \"react-quill/dist/quill.snow.css\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { Row, Col, Modal, Button, Form, Toast, Card } from \"react-bootstrap\";\r\nimport Container from \"../components/Container\";\r\nimport BlogScreenBlogPosts from \"../components/BlogScreenBlogPosts\";\r\nimport FormContainer from \"../components/FormContainer\";\r\nimport Loader from \"../components/Loader\";\r\nimport Message from \"../components/Message\";\r\nimport { listBlogs, createBlogPost } from \"../actions/blogActions\";\r\nimport Tippy from \"@tippy.js/react\";\r\nimport { requestAuthorship } from \"../actions/userActions\";\r\n\r\nconst BlogScreen = () => {\r\n  const [convertedText, setConvertedText] = useState(\"\");\r\n  const [description, setDescription] = useState(\"\");\r\n  const [message, setMessage] = useState(\"false\");\r\n  const [toastShow, setToastShow] = useState(false);\r\n  const [postShow, setPostShow] = useState(false);\r\n  const [postTitle, setPostTitle] = useState(\"\");\r\n  const [uploading, setUploading] = useState(false);\r\n  const [image, setImage] = useState(\"\");\r\n\r\n  const handlePostClose = () => setPostShow(false);\r\n  const handlePostShow = () => setPostShow(true);\r\n\r\n  const userLogin = useSelector((state) => state.userLogin);\r\n  const { userInfo } = userLogin;\r\n\r\n  const userAuthor = useSelector((state) => state.userAuthor);\r\n  const { success: authorSuccess } = userAuthor;\r\n\r\n  const blogList = useSelector((state) => state.blogList);\r\n  const { loading, error, blogs } = blogList;\r\n\r\n  const createBlog = useSelector((state) => state.createBlog);\r\n  const { success } = createBlog;\r\n\r\n  const blogDeletePost = useSelector((state) => state.blogDeletePost);\r\n  const { success: deleteSuccess } = blogDeletePost;\r\n\r\n  const blogLike = useSelector((state) => state.blogLike);\r\n  const { success: likeSuccess } = blogLike;\r\n  const blogComment = useSelector((state) => state.blogComment);\r\n  const { success: commentSuccess } = blogComment;\r\n\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    dispatch(listBlogs());\r\n\r\n    if (authorSuccess) {\r\n      setMessage(`Your request for the author role has been received.`);\r\n      setTimeout(() => {\r\n        setMessage(false);\r\n      }, 5000);\r\n    }\r\n  }, [\r\n    dispatch,\r\n    success,\r\n    deleteSuccess,\r\n    likeSuccess,\r\n    authorSuccess,\r\n    commentSuccess,\r\n  ]);\r\n\r\n  const submitHandler = (e) => {\r\n    e.preventDefault();\r\n    if (!userInfo.isAuthor) {\r\n      setToastShow(true);\r\n      setMessage(`Must be an author to make a post.`);\r\n      setTimeout(() => {\r\n        setMessage(false);\r\n      }, 5000);\r\n    } else {\r\n      dispatch(createBlogPost(postTitle, convertedText, image, description));\r\n      setConvertedText(\"\");\r\n      setDescription(\"\");\r\n      setPostTitle(\"\");\r\n    }\r\n  };\r\n\r\n  const authorHandler = () => {\r\n    dispatch(requestAuthorship(userInfo._id));\r\n  };\r\n\r\n  const uploadFileHandler = async (e) => {\r\n    const file = e.target.files[0];\r\n    const formData = new FormData();\r\n    formData.append(\"image\", file);\r\n    setUploading(true);\r\n\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          \"Content-Type\": \"multipart/form-data\",\r\n        },\r\n      };\r\n      const { data } = await axios.post(\"/api/upload\", formData, config);\r\n\r\n      setImage(data);\r\n      setUploading(false);\r\n    } catch (error) {\r\n      console.error(error);\r\n      setUploading(false);\r\n    }\r\n  };\r\n  return (\r\n    <>\r\n      <Container>\r\n        <Row className=\"d-flex justify-content-between\">\r\n          <Col md={9} className=\"d-flex align-items-end\">\r\n            <h1>Community Writing Blog</h1>{\" \"}\r\n            {authorSuccess && <Message variant=\"info\">{message}</Message>}\r\n          </Col>\r\n          <Col md={3} className=\"d-flex justify-content-end align-items-end\">\r\n            {userInfo && userInfo.isAuthor && (\r\n              <Button variant=\"\" onClick={handlePostShow}>\r\n                Create a Post <i className=\"fas fa-4x fa-edit\"></i>\r\n              </Button>\r\n            )}\r\n            {!userInfo.isAuthor && !userInfo.authorRequest && (\r\n              <Button variant=\"\" onClick={authorHandler}>\r\n                Request Author Role <i className=\"fas fa-4x fa-edit\"></i>\r\n                <Tippy\r\n                  content=\"The Author role allows users to contribute their own blog post to the community. Requests must be approved by an Administrator.\"\r\n                  placement=\"top\"\r\n                  arrow={false}\r\n                  delay={300}\r\n                >\r\n                  <i className=\"fas fa-info-circle mx-1\"></i>\r\n                </Tippy>\r\n              </Button>\r\n            )}\r\n          </Col>\r\n        </Row>\r\n        <hr\r\n          style={{\r\n            color: \"black\",\r\n            backgroundColor: \"black\",\r\n            height: 5,\r\n          }}\r\n        />\r\n        <Modal dialogClassName=\"w-50\" show={postShow} onHide={handlePostClose}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Create A Post</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>\r\n            <FormContainer>\r\n              <Form onSubmit={submitHandler}>\r\n                <Form.Label>Post Title</Form.Label>\r\n                <Form.Group controlId=\"title\">\r\n                  <Form.Control\r\n                    value={postTitle}\r\n                    onChange={(e) => setPostTitle(e.target.value)}\r\n                  ></Form.Control>\r\n                </Form.Group>\r\n                <Form.Label>Post Description</Form.Label>\r\n                <Form.Group controlId=\"description\">\r\n                  <Form.Control\r\n                    value={description}\r\n                    onChange={(e) => setDescription(e.target.value)}\r\n                    placeholder=\"What's this blog post about?\"\r\n                  ></Form.Control>\r\n                </Form.Group>\r\n                <Form.Label>Post Body</Form.Label>\r\n                <Form.Group controlId=\"body\">\r\n                  <ReactQuill\r\n                    className=\"mb-2 p-1\"\r\n                    theme=\"snow\"\r\n                    value={convertedText}\r\n                    onChange={setConvertedText}\r\n                  />\r\n                </Form.Group>\r\n                <Form.Group controlId=\"image\">\r\n                  <Form.Label>Image</Form.Label>\r\n                  <Form.Control\r\n                    type=\"text\"\r\n                    value={image}\r\n                    placeholder=\"Enter image url\"\r\n                    onChange={(e) => setImage(e.target.value)}\r\n                  ></Form.Control>\r\n                  <Form.Control\r\n                    id=\"image-file\"\r\n                    label=\"Choose File\"\r\n                    type=\"file\"\r\n                    onChange={uploadFileHandler}\r\n                  ></Form.Control>\r\n                  {uploading && <Loader />}\r\n                </Form.Group>\r\n                <Button\r\n                  className=\"my-3\"\r\n                  variant=\"outline-dark\"\r\n                  type=\"submit\"\r\n                  onClick={handlePostClose}\r\n                >\r\n                  Submit Blog Post\r\n                </Button>\r\n              </Form>\r\n            </FormContainer>\r\n          </Modal.Body>\r\n        </Modal>\r\n        {loading && <Loader />}\r\n        {error && <Message variant=\"danger\">{error}</Message>}\r\n        <Toast\r\n          onClose={() => setToastShow(false)}\r\n          show={toastShow}\r\n          delay={5000}\r\n          autohide\r\n        >\r\n          <Toast.Header>{message}</Toast.Header>\r\n        </Toast>{\" \"}\r\n        {blogs && blogs.length > 0 ? (\r\n          <Card>\r\n            <Row className=\"mb-3\">\r\n              {blogs\r\n                .sort(\r\n                  (a, b) => Date.parse(b.createdAt) - Date.parse(a.createdAt)\r\n                )\r\n                .map((blog) => {\r\n                  return (\r\n                    <Col key={blog._id} sm={12} md={6} lg={4} xl={4}>\r\n                      <BlogScreenBlogPosts blog={blog} />\r\n                    </Col>\r\n                  );\r\n                })}\r\n            </Row>\r\n          </Card>\r\n        ) : (\r\n          <Message variant=\"info\">\r\n            No Blog Posts. Be the first to contribute to our community!\r\n          </Message>\r\n        )}\r\n      </Container>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default BlogScreen;\r\n"]},"metadata":{},"sourceType":"module"}