{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/elijr/Desktop/CODING/Personal Projects/Portfolio/eco/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/elijr/Desktop/CODING/Personal Projects/Portfolio/eco/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/elijr/Desktop/CODING/Personal Projects/Portfolio/eco/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{Form,Button}from\"react-bootstrap\";import Loader from\"./Loader\";import Message from\"./Message\";import{PaymentElement,useStripe,useElements}from\"@stripe/react-stripe-js\";import{payOrder}from\"../actions/orderActions\";import{useDispatch}from\"react-redux\";import{useNavigate}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CheckoutForm=function CheckoutForm(_ref){var clientSecret=_ref.clientSecret,id=_ref.id;//Hooks\nvar _useState=useState(null),_useState2=_slicedToArray(_useState,2),message=_useState2[0],setMessage=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),success=_useState4[0],setSuccess=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isLoading=_useState6[0],setIsLoading=_useState6[1];var dispatch=useDispatch();var navigate=useNavigate();//Stripe\nvar stripe=useStripe();var elements=useElements();//useEffect\nuseEffect(function(){if(!stripe){return;}if(!clientSecret){return;}if(success){setTimeout(function(){navigate(\"/order/review/\".concat(id));},3500);}},[stripe,success,clientSecret,id,navigate]);//Handlers\nvar handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var _yield$stripe$confirm,error;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(!stripe||!elements)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:setIsLoading(true);//disable redirect on confirmPayment\n_context.next=6;return stripe.confirmPayment({elements:elements,redirect:\"if_required\"});case 6:_yield$stripe$confirm=_context.sent;error=_yield$stripe$confirm.error;//Check payment status, set Order Pay on success\nstripe.retrievePaymentIntent(clientSecret).then(function(response){if(response.paymentIntent&&response.paymentIntent.status===\"succeeded\"){setMessage(\"Payment Succeeded\");setSuccess(true);dispatch(payOrder(id,\"Stripe\"));}else{setMessage(\"Something went wrong\");}});setIsLoading(false);case 10:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(Form,{id:\"payment-form\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(Form.Label,{as:\"legend\",children:\"Stripe Secure Payments\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(PaymentElement,{id:\"payment-element\"}),/*#__PURE__*/_jsx(Button,{className:\"my-3\",variant:\"primary\",disabled:isLoading||!stripe||!elements||success,type:\"submit\",children:\"Pay Here\"}),isLoading&&/*#__PURE__*/_jsx(Loader,{}),message&&/*#__PURE__*/_jsx(Message,{id:\"payment-message\",children:message})]});};export default CheckoutForm;","map":{"version":3,"sources":["C:/Users/elijr/Desktop/CODING/Personal Projects/Portfolio/eco/frontend/src/components/CheckoutForm.js"],"names":["React","useEffect","useState","Form","Button","Loader","Message","PaymentElement","useStripe","useElements","payOrder","useDispatch","useNavigate","CheckoutForm","clientSecret","id","message","setMessage","success","setSuccess","isLoading","setIsLoading","dispatch","navigate","stripe","elements","setTimeout","handleSubmit","e","preventDefault","confirmPayment","redirect","error","retrievePaymentIntent","then","response","paymentIntent","status"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { Form, Button } from \"react-bootstrap\";\r\nimport Loader from \"./Loader\";\r\nimport Message from \"./Message\";\r\nimport {\r\n  PaymentElement,\r\n  useStripe,\r\n  useElements,\r\n} from \"@stripe/react-stripe-js\";\r\nimport { payOrder } from \"../actions/orderActions\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\nconst CheckoutForm = ({ clientSecret, id }) => {\r\n  //Hooks\r\n  const [message, setMessage] = useState(null);\r\n  const [success, setSuccess] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  const dispatch = useDispatch();\r\n  const navigate = useNavigate();\r\n\r\n  //Stripe\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n\r\n  //useEffect\r\n  useEffect(() => {\r\n    if (!stripe) {\r\n      return;\r\n    }\r\n    if (!clientSecret) {\r\n      return;\r\n    }\r\n\r\n    if (success) {\r\n      setTimeout(() => {\r\n        navigate(`/order/review/${id}`);\r\n      }, 3500);\r\n    }\r\n  }, [stripe, success, clientSecret, id, navigate]);\r\n\r\n  //Handlers\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n\r\n    if (!stripe || !elements) {\r\n      // Stripe.js has not yet loaded.\r\n      // Make sure to disable form submission until Stripe.js has loaded.\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n\r\n    //disable redirect on confirmPayment\r\n    const { error } = await stripe.confirmPayment({\r\n      elements,\r\n      redirect: \"if_required\",\r\n    });\r\n\r\n    //Check payment status, set Order Pay on success\r\n    stripe.retrievePaymentIntent(clientSecret).then(function (response) {\r\n      if (\r\n        response.paymentIntent &&\r\n        response.paymentIntent.status === \"succeeded\"\r\n      ) {\r\n        setMessage(\"Payment Succeeded\");\r\n        setSuccess(true);\r\n        dispatch(payOrder(id, \"Stripe\"));\r\n      } else {\r\n        setMessage(\"Something went wrong\");\r\n      }\r\n    });\r\n\r\n    setIsLoading(false);\r\n  };\r\n\r\n  return (\r\n    <Form id=\"payment-form\" onSubmit={handleSubmit}>\r\n      <Form.Label as=\"legend\">Stripe Secure Payments</Form.Label>\r\n      <hr />\r\n      <PaymentElement id=\"payment-element\" />\r\n      <Button\r\n        className=\"my-3\"\r\n        variant=\"primary\"\r\n        disabled={isLoading || !stripe || !elements || success}\r\n        type=\"submit\"\r\n      >\r\n        Pay Here\r\n      </Button>\r\n      {isLoading && <Loader />}\r\n      {message && <Message id=\"payment-message\">{message}</Message>}\r\n    </Form>\r\n  );\r\n};\r\n\r\nexport default CheckoutForm;\r\n"]},"metadata":{},"sourceType":"module"}